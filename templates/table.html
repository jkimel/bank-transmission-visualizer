{% extends "base.html" %}

{% block title %}Tabla de Datos - Conexiones de Latencia{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="card-title mb-0">
                    Tabla de Conexiones de Red
                </h4>
                <div>
                    <a href="{{ url_for('upload_page') }}" class="btn btn-warning btn-sm">
                        <i class="fas fa-upload me-1"></i>Subir Nuevo CSV
                    </a>
                </div>
            </div>
            <div id="dataInfoPanel" class="data-info-panel alert alert-info d-none">
                </div>
            <div class="card-body">
                <div class="row g-3 mb-4">
                    <div class="col-md-4">
                        <label class="form-label small fw-bold text-muted">Búsqueda General</label>
                        <div class="input-group input-group-sm">
                            <span class="input-group-text bg-light"><i class="fas fa-search"></i></span>
                            <input type="text" id="searchInput" class="form-control" placeholder="Buscar ID, latencia...">
                        </div>
                    </div>
                    
                    <div class="col-md-3">
                        <label class="form-label small fw-bold text-muted">Filtrar Origen</label>
                        <select id="filterOrigen" class="form-select form-select-sm">
                            <option value="">Todos</option>
                            </select>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label small fw-bold text-muted">Filtrar Destino</label>
                        <select id="filterDestino" class="form-select form-select-sm">
                            <option value="">Todos</option>
                            </select>
                    </div>

                    <div class="col-md-2 d-flex align-items-end">
                        <div class="d-flex w-100 gap-2">
                            <button id="applyFilters" class="btn btn-primary btn-sm flex-grow-1" title="Aplicar filtros seleccionados">
                                Aplicar
                            </button>
                            <button id="resetFilters" class="btn btn-light btn-sm border" title="Limpiar filtros">
                                <i class="fas fa-redo text-muted"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-sm table-hover align-middle">
                        <thead class="table-light" id="tableHeaders">
                            <tr>
                                <th data-sort="id" style="width: 80px; cursor: pointer;">
                                    ID <i class="fas fa-sort ms-1 text-muted"></i>
                                </th>
                                <th data-sort="Origen" style="cursor: pointer;">
                                    Origen <i class="fas fa-sort ms-1 text-muted"></i>
                                </th>
                                <th data-sort="Destino" style="cursor: pointer;">
                                    Destino <i class="fas fa-sort ms-1 text-muted"></i>
                                </th>
                                <th data-sort="Latencia_ms" style="cursor: pointer;">
                                    Latencia (ms) <i class="fas fa-sort ms-1 text-muted"></i>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="tableBody">
                            </tbody>
                    </table>
                </div>
                
                <div class="d-flex justify-content-between align-items-center mt-3 border-top pt-3">
                    <div class="d-flex align-items-center">
                        <select id="pageSize" class="form-select form-select-sm w-auto me-3" style="border-color: #dee2e6;">
                            <option value="10">10 filas</option>
                            <option value="25" selected>25 filas</option>
                            <option value="50">50 filas</option>
                            <option value="100">100 filas</option>
                        </select>
                        <span class="text-muted small">
                            <span id="showingFrom">0</span>-<span id="showingTo">0</span> de 
                            <span id="totalRows">0</span>
                        </span>
                    </div>
                    <nav>
                        <ul class="pagination pagination-sm mb-0" id="pagination"></ul>
                    </nav>
                </div>
            </div>
        </div>

        <div class="card mt-4">
            <div class="card-body">
                <h6 class="card-title"><i class="fas fa-mouse-pointer me-2"></i>Instrucciones</h6>
                <p class="card-text small mb-2">
                    • Para visualizar las rutas más cortas, ve a la pestaña <span class="fw-semibold">Visualización</span>
                </p>
                <p class="card-text small mb-2">
                    • Usa la búsqueda para encontrar conexiones específicas
                </p>
                <p class="card-text small">
                    • Ordena haciendo clic en los encabezados de columna
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/table.js') }}"></script>
<script>
// Inicializar la tabla cuando la página cargue
document.addEventListener('DOMContentLoaded', function() {
    window.tableManager = new DataTableManager();
    
    // Descargar CSV (si tienes el botón en base.html)
    const downloadBtn = document.getElementById('downloadBtn');
    if (downloadBtn) {
        downloadBtn.addEventListener('click', function() {
            window.location.href = '/api/download';
        });
    }
});
</script>
{% endblock %}